<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contact | Maximum Gamers</title>
  <link rel="icon" href="/images/logo.png" type="image/png">
  

  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  
  <style>
    body {
      background-color: #121212;
      color: #f8f9fa;
    }
    .list-group-item {
      background-color: #1e1e1e;
      border: 1px solid #333;
    }
  </style>
</head>
<body>
<!-- Contact Section -->
<div class="container my-5">
  <h2 class="mb-4">Contact / Messages</h2>

  <div id="statusMsg"></div>

  <form id="contactForm">
    <textarea name="message" class="form-control mb-2" placeholder="Type your message..." required></textarea>
    <button type="submit" class="btn btn-primary">Send</button>
  </form>

  <ul id="userMessages" class="list-group mt-3"></ul>
</div>

<!-- Footer -->
<footer class="mt-5 pt-5 border-top border-secondary">
  <div class="container">
    <div class="row text-center text-md-start g-3">
      <div class="col-6 col-md-3">
        <h6 class="fw-bold">Discover</h6>
        <ul class="list-unstyled">
          <li><a href="/gaming" class="text-white text-decoration-none">Gaming Sessions</a></li>
          <li><a href="/loans" class="text-white text-decoration-none">Quick Loans</a></li>
          <li><a href="/shop" class="text-white text-decoration-none">Store</a></li>
        </ul>
      </div>
      <div class="col-6 col-md-3">
        <h6 class="fw-bold">Company</h6>
        <ul class="list-unstyled">
          <li><a href="/about" class="text-white text-decoration-none">About Us</a></li>
          <li><a href="/contact" class="text-white text-decoration-none">Contact</a></li>
          <li><a href="/careers" class="text-white text-decoration-none">Careers</a></li>
        </ul>
      </div>
      <div class="col-6 col-md-3">
        <h6 class="fw-bold">Connect</h6>
        <ul class="list-unstyled">
          <li><a href="#" class="text-white text-decoration-none">Instagram</a></li>
          <li><a href="#" class="text-white text-decoration-none">Twitter</a></li>
          <li><a href="#" class="text-white text-decoration-none">Facebook</a></li>
        </ul>
      </div>
      <div class="col-6 col-md-3">
        <h6 class="fw-bold">Legal</h6>
        <ul class="list-unstyled">
          <li><a href="/privacy-policy" class="text-white text-decoration-none">Privacy Policy</a></li>
          <li><a href="/terms" class="text-white text-decoration-none">Terms & Conditions</a></li>
          <li><a href="/refund-policy" class="text-white text-decoration-none">Refund Policy</a></li>
        </ul>
      </div>
    </div>
    <div class="mt-4 text-center small text-secondary">
      &copy; 2025 Maximum Gamers. All Rights Reserved.
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const form = document.getElementById("contactForm");
  const statusMsg = document.getElementById("statusMsg");
  const userMessages = document.getElementById("userMessages");

  // Add a message to the list
  function addUserMessage(msg) {
    const li = document.createElement("li");
    li.id = `msg-${msg._id}`;
    li.className = "list-group-item d-flex justify-content-between align-items-start";
    li.innerHTML = `
      <div>
        <b>You:</b> ${msg.content}
        <div class="text-success mt-1"><b>Admin:</b> ${msg.reply || ""}</div>
      </div>
      <button class="btn btn-sm btn-danger ms-2" onclick="deleteMessage('${msg._id}')">Delete</button>
    `;
    userMessages.prepend(li);
  }

  // Load existing messages
  async function loadMessages() {
    try {
      const res = await fetch("/messages");
      const data = await res.json();
      if (data.success) {
        userMessages.innerHTML = "";
        data.messages.forEach(addUserMessage);
      }
    } catch (err) {
      console.error(err);
    }
  }

  // Delete a message
  async function deleteMessage(id) {
    try {
      const res = await fetch(`/messages/${id}`, { method: "DELETE" });
      const result = await res.json();
      if (result.success) {
        const el = document.getElementById(`msg-${id}`);
        if (el) el.remove();
      }
    } catch (err) {
      console.error(err);
    }
  }

  // Submit a new message
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const content = form.message.value.trim();
    if (!content) return;

    try {
      const res = await fetch("/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      });
      const result = await res.json();
      if (result.success) {
        form.reset();
        statusMsg.innerHTML = '<div class="alert alert-success">✅ Message sent!</div>';
        addUserMessage(result.message);
        socket.emit("new-message", result.message);
      } else {
        statusMsg.innerHTML = `<div class="alert alert-danger">${result.message || "Failed"}</div>`;
      }
    } catch (err) {
      console.error(err);
      statusMsg.innerHTML = '<div class="alert alert-danger">❌ Error sending message</div>';
    }
  });

  // Listen for admin replies
  socket.on("messageReplied", (msg) => {
    const el = document.getElementById(`msg-${msg._id}`);
    if (el) el.querySelector("div.text-success").innerHTML = `<b>Admin:</b> ${msg.reply}`;
  });

  // Listen for deleted messages
  socket.on("messageDeleted", (id) => {
    const el = document.getElementById(`msg-${id}`);
    if (el) el.remove();
  });

  loadMessages();
</script>
</body>
</html>
