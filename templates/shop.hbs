<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop | Maximum Gamers - Gaming Products Marketplace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        :root { 
            --primary-color: #2c5aa0; 
            --secondary-color: #ff6b00;
            --accent-color: #00a859; 
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        /* Header Styles */
        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand { 
            font-size: 1.5rem; 
            font-weight: 800; 
        } 
        
        .nav-link.active { 
            color: var(--secondary-color) !important; 
            font-weight: 600; 
        } 
        
        .search-container { 
            max-width: 500px; 
        } 
        
        .search-box {
            border-radius: 25px; 
            border: 2px solid #e0e0e0; 
        } 
        
        .search-box:focus {
            border-color: var(--secondary-color); 
            box-shadow: none; 
        }
        
        /* Product Cards */
        .card-title { 
            font-weight: bold; 
            font-size: 1rem; 
            height: 2.5rem;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        } 
        
        .market-price { 
            text-decoration: line-through; 
            color: #6c757d;
            font-size: 0.9rem; 
        } 
        
        .sale-price { 
            font-weight: bold; 
            font-size: 1.05rem;
            color: var(--secondary-color); 
        } 
        
        .add-to-cart { 
            width: 100%; 
            font-size: 0.9rem; 
            padding: 0.4rem; 
            background: var(--secondary-color); 
            border: none;
        } 
        
        .add-to-cart:hover { 
            background: #e55a00; 
        } 
        
        .product-card { 
            border: none; 
            border-radius: 8px; 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            overflow: hidden; 
            height: 100%;
        } 
        
        .product-card:hover {
            transform: translateY(-5px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
        } 
        
        .card-img-top { 
            object-fit: cover; 
            transition: transform 0.3s ease; 
        } 
        
        .product-card:hover .card-img-top { 
            transform: scale(1.05); 
        }
        
        .discount-badge { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            background: var(--secondary-color); 
            color: white; 
            padding: 0.3rem 0.6rem;
            border-radius: 15px; 
            font-size: 0.8rem; 
            font-weight: 600; 
        } 
        
        .verified-badge { 
            color: var(--accent-color); 
            font-size: 0.8rem; 
        }
        
        /* Filter Section */
        .filter-section { 
            background: white; 
            border-radius: 8px;
            padding: 1.5rem; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        } 
        
        .filter-title { 
            font-weight: 600; 
            color: var(--primary-color); 
            margin-bottom: 1rem; 
            font-size: 1.1rem;
        } 
        
        .filter-group {
            margin-bottom: 1.5rem; 
        } 
        
        .filter-btn { 
            background: white; 
            border: 1px solid #ddd; 
            border-radius: 20px; 
            padding: 0.3rem 1rem; 
            margin: 0.2rem;
            font-size: 0.85rem; 
        } 
        
        .filter-btn.active { 
            background: var(--primary-color); 
            color: white; 
            border-color: var(--primary-color); 
        } 
        
        .price-range { 
            width: 100%; 
            margin: 0.5rem 0; 
        } 
        
        .price-display {
            font-size: 0.9rem; 
            color: #666; 
        }
        
        /* Cart Sidebar */
        #cart-sidebar { 
            position: fixed; 
            right: 0; 
            top: 0;
            height: 100%; 
            width: 350px; 
            background: white; 
            border-left: 1px solid #ddd; 
            padding: 1.5rem; 
            overflow-y: auto; 
            box-shadow: -2px 0 15px rgba(0,0,0,0.1); 
            display: none; 
            z-index: 1050; 
        } 
        
        #cart-toggle { 
            position: fixed; 
            right: 20px; 
            top: 50%; 
            transform: translateY(-50%);
            z-index: 1100; 
            background: var(--secondary-color); 
            border: none; 
            border-radius: 25px; 
            padding: 0.6rem 1.2rem; 
            font-weight: 600; 
            box-shadow: 0 4px 12px rgba(255,107,0,0.3); 
            transition: all 0.3s ease;
        } 
        
        #cart-toggle:hover {
            transform: translateY(-50%) scale(1.05);
        }
        
        .cart-item { 
            border-bottom: 1px solid #eee; 
            padding: 0.8rem 0; 
        } 
        
        .cart-item:last-child { 
            border-bottom: none; 
        }
        
        /* Image Gallery */
        .image-gallery {
            position: relative;
        }
        
        .image-count-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        .carousel-thumb {
            width: 80px;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
            border-radius: 5px;
        }
        
        .carousel-thumb.active {
            opacity: 1;
            border: 2px solid var(--secondary-color);
        }
        
        /* Jumia-style elements */
        .featured-banner {
            background: linear-gradient(135deg, var(--primary-color), #1e3a6d);
            color: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .quick-stats { 
            background: white; 
            border-radius: 8px; 
            padding: 1rem; 
            text-align: center; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        } 
        
        .stats-number {
            font-size: 1.5rem; 
            font-weight: 700; 
            color: var(--primary-color); 
        } 
        
        .stats-label { 
            font-size: 0.8rem; 
            color: #666; 
        }
        
        .results-count { 
            color: #666; 
            font-size: 0.9rem; 
        } 
        
        .sort-select {
            border-radius: 5px; 
            border: 1px solid #ddd; 
            padding: 0.4rem 1rem; 
        }
        
        /* Responsive adjustments */
        @media (max-width: 575.98px) { 
            #shop-products .col-product { 
                flex: 0 0 50%; 
                max-width: 50%; 
                padding: 0.5rem; 
            } 
            
            #shop-products .card-img-top { 
                height: 150px; 
            } 
            
            .filter-section { 
                margin-bottom: 1rem; 
            } 
            
            #cart-toggle {
                right: 10px;
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        } 
        
        @media (min-width: 576px) and (max-width: 991.98px) { 
            #shop-products .col-product {
                flex: 0 0 33.3333%; 
                max-width: 33.3333%; 
            } 
            
            #shop-products .card-img-top { 
                height: 180px; 
            } 
        } 
        
        @media (min-width: 992px) { 
            #shop-products .col-product { 
                flex: 0 0 25%; 
                max-width: 25%; 
            } 
            
            #shop-products .card-img-top { 
                height: 200px; 
            } 
        }
        
        /* Mobile Menu */
        .offcanvas-header {
            background-color: var(--primary-color);
            color: white;
        }
        
        .offcanvas-body .nav-link {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .offcanvas-body .nav-link:hover {
            background-color: #f8f9fa;
        }
        
        /* Load More Button */
        .load-more-container {
            margin: 2rem 0;
        }
        
        .load-more-btn {
            padding: 0.75rem 2rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <i class="bi bi-joystick me-2"></i>Maximum Gamers
            </a>

            <!-- Search Bar -->
            <div class="search-container mx-3 flex-grow-1">
                <div class="input-group">
                    <input
                        type="text"
                        id="search-input"
                        class="form-control search-box"
                        placeholder="Search for gaming products, consoles, accessories..."
                    />
                    <button class="btn btn-outline-light" type="button" id="search-btn">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
            </div>

            <div class="d-flex align-items-center ms-auto">
                <a
                    href="javascript:void(0)"
                    id="navbar-cart-btn"
                    class="btn position-relative me-3"
                >
                    <i class="bi bi-cart3 fs-5 text-white"></i>
                    <span
                        id="cart-badge"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                    >0</span>
                </a>
                <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="offcanvas"
                    data-bs-target="#mobileMenu"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>

            <div
                class="collapse navbar-collapse d-none d-lg-flex justify-content-center"
            >
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="/user"><i
                            class="bi bi-house me-1"
                        ></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/shop"><i
                            class="bi bi-shop me-1"
                        ></i>Shop</a></li>
                    <li class="nav-item"><a class="nav-link" href="/gaming"><i
                            class="bi bi-calendar-event me-1"
                        ></i>Booking</a></li>
                    <li class="nav-item"><a class="nav-link" href="/loans"><i
                            class="bi bi-cash-coin me-1"
                        ></i>Loans</a></li>
                    <li class="nav-item"><a class="nav-link" href="/contact"><i
                            class="bi bi-telephone me-1"
                        ></i>Contact</a></li>
                    <li class="nav-item"><a class="nav-link" href="/profile"><i
                            class="bi bi-person me-1"
                        ></i>Profile</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="mobileMenu">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Maximum Gamers</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="/user"><i
                        class="bi bi-house me-2"
                    ></i>Home</a></li>
                <li class="nav-item"><a class="nav-link active" href="/shop"><i
                        class="bi bi-shop me-2"
                    ></i>Shop</a></li>
                <li class="nav-item"><a class="nav-link" href="/gaming"><i
                        class="bi bi-calendar-event me-2"
                    ></i>Booking</a></li>
                <li class="nav-item"><a class="nav-link" href="/loans"><i
                        class="bi bi-cash-coin me-2"
                    ></i>Loans</a></li>
                <li class="nav-item"><a class="nav-link" href="/contact"><i
                        class="bi bi-telephone me-2"
                    ></i>Contact</a></li>
                <li class="nav-item"><a class="nav-link" href="/profile"><i
                        class="bi bi-person me-2"
                    ></i>Profile</a></li>
            </ul>
        </div>
    </div>

    <!-- FEATURED BANNER -->
    <div class="container mt-4">
        <div class="featured-banner p-4 bg-dark text-white rounded-3 shadow-sm">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="mb-2">🎮 Exclusive Deals of the Week!</h4>
                    <p class="mb-0">
                        Explore our top picks and grab your favorite brands before the
                        offer ends!
                    </p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <button class="btn btn-warning btn-sm fw-semibold">
                        Shop Your Favorites
                        <i class="bi bi-arrow-right ms-1"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SHOP CONTENT -->
    <div class="container my-4">
        <div class="row">
            <!-- FILTER SIDEBAR -->
            <div class="col-lg-3 mb-4">
                <div class="filter-section sticky-top" style="top: 20px;">
                    <h5 class="filter-title"><i
                        class="bi bi-funnel me-2"
                    ></i>Filters</h5>

                    <!-- Search Within -->
                    <div class="filter-group">
                        <label class="form-label fw-semibold">Search</label>
                        <input
                            type="text"
                            id="filter-search"
                            class="form-control form-control-sm"
                            placeholder="Filter products..."
                        />
                    </div>

                    <!-- Category Filter -->
                    <div class="filter-group">
                        <label class="form-label fw-semibold">Category</label>
                        <div>
                            <button
                                class="filter-btn category-filter active"
                                data-category="all"
                            >All</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Consoles"
                            >Consoles</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Games"
                            >Games</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Accessories"
                            >Accessories</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="PC Parts"
                            >PC Parts</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Controllers"
                            >Controllers</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Headsets"
                            >Headsets</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Monitors"
                            >Monitors</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Cables"
                            >Cables</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Storage"
                            >Storage</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Keyboards"
                            >Keyboards</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Mice"
                            >Mice</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Speakers"
                            >Speakers</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Woofers"
                            >Woofers</button>
                            <button
                                class="filter-btn category-filter"
                                data-category="Other"
                            >Other</button>
                        </div>
                    </div>

                    <!-- Price Range -->
                    <div class="filter-group">
                        <label class="form-label fw-semibold">Price Range</label>
                        <input
                            type="range"
                            class="form-range price-range"
                            id="price-range"
                            min="0"
                            max="1000000"
                            step="1000"
                            value="1000000"
                        />
                        <div class="d-flex justify-content-between price-display">
                            <span>Ksh 0</span>
                            <span id="price-max-display">Ksh 1,000,000</span>
                        </div>
                    </div>

                    <!-- Condition Filter -->
                    <div class="filter-group">
                        <label class="form-label fw-semibold">Condition</label>
                        <div>
                            <button
                                class="filter-btn condition-filter active"
                                data-condition="all"
                            >All</button>
                            <button
                                class="filter-btn condition-filter"
                                data-condition="New"
                            >New</button>
                            <button
                                class="filter-btn condition-filter"
                                data-condition="Used"
                            >Used</button>
                            <button
                                class="filter-btn condition-filter"
                                data-condition="Refurbished"
                            >Refurbished</button>
                            <button
                                class="filter-btn condition-filter"
                                data-condition="Like New"
                            >Like New</button>
                            <button
                                class="filter-btn condition-filter"
                                data-condition="Open Box"
                            >Open Box</button>
                            <button
                                class="filter-btn condition-filter"
                                data-condition="Other"
                            >Other</button>
                        </div>
                    </div>

                    <!-- Brand Filter -->
                    <div class="filter-group">
                        <label class="form-label fw-semibold">Brand</label>
                        <div class="d-flex flex-wrap gap-2">
                            <!-- All -->
                            <button
                                class="filter-btn brand-filter active"
                                data-brand="all"
                            >All Brands</button>

                            <!-- 🎮 Gaming & Consoles -->
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Sony"
                            >Sony</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Microsoft"
                            >Microsoft</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Nintendo"
                            >Nintendo</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Razer"
                            >Razer</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Logitech"
                            >Logitech</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Corsair"
                            >Corsair</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="SteelSeries"
                            >SteelSeries</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Astro"
                            >Astro</button>

                            <!-- 💻 Laptops & Computers -->
                            <button
                                class="filter-btn brand-filter"
                                data-brand="HP"
                            >HP</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Dell"
                            >Dell</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Asus"
                            >Asus</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Acer"
                            >Acer</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Lenovo"
                            >Lenovo</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="MSI"
                            >MSI</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Alienware"
                            >Alienware</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Apple"
                            >Apple</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Huawei"
                            >Huawei</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Samsung"
                            >Samsung</button>

                            <!-- 📱 Phones & Mobile -->
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Xiaomi"
                            >Xiaomi</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Oppo"
                            >Oppo</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Vivo"
                            >Vivo</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="OnePlus"
                            >OnePlus</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Tecno"
                            >Tecno</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Infinix"
                            >Infinix</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Realme"
                            >Realme</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Nokia"
                            >Nokia</button>

                            <!-- ⚙️ PC Components & Storage -->
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Gigabyte"
                            >Gigabyte</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="EVGA"
                            >EVGA</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Seagate"
                            >Seagate</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Western Digital"
                            >Western Digital</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Kingston"
                            >Kingston</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="HyperX"
                            >HyperX</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Cooler Master"
                            >Cooler Master</button>
                            <button
                                class="filter-btn brand-filter"
                                data-brand="Other"
                            >Other</button>
                        </div>
                    </div>

                    <!-- Clear Filters -->
                    <button
                        class="btn btn-outline-secondary w-100 mt-3"
                        id="clear-filters"
                    >
                        <i class="bi bi-x-circle me-1"></i>Clear All Filters
                    </button>
                </div>
            </div>

            <!-- PRODUCTS GRID -->
            <div class="col-lg-9">
                <!-- Results Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h4 class="mb-1">Gaming Products</h4>
                        <p class="results-count mb-0" id="results-count">Loading products...</p>
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        <select class="sort-select" id="sort-select">
                            <option value="featured">Featured</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="name">Name: A to Z</option>
                            <option value="newest">Newest First</option>
                        </select>

                        <!-- Quick Stats -->
                        <div class="quick-stats">
                            <div class="stats-number" id="products-count">0</div>
                            <div class="stats-label">Products</div>
                        </div>
                    </div>
                </div>

                <!-- Products Grid -->
                <div class="row d-flex flex-wrap" id="shop-products">
                    <div class="col-12 text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading products...</p>
                    </div>
                </div>

                <!-- Load More Button -->
                <div class="text-center load-more-container" id="load-more-container" style="display: none;">
                    <button class="btn btn-primary load-more-btn" id="load-more-btn">
                        <i class="bi bi-arrow-down-circle me-2"></i>Load More Products
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Cart Button -->
    <button class="btn btn-primary" id="cart-toggle">
        <i class="bi bi-cart"></i>
        Cart (<span id="cart-count">0</span>)
    </button>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar">
        <h4><i class="bi bi-cart3 me-2"></i>Your Shopping Cart</h4>
        <div id="cart-items"></div>
        <hr />
        <p class="fw-bold fs-5">Total: Ksh <span id="cart-total">0</span></p>

        <div class="mb-3">
            <label class="form-label fw-semibold"><i
                class="bi bi-person me-1"
            ></i>Your Name</label>
            <input
                type="text"
                id="customer-name"
                class="form-control"
                placeholder="Enter your full name"
            />
        </div>
        <div class="mb-3">
            <label class="form-label fw-semibold"><i
                class="bi bi-telephone me-1"
            ></i>Your Phone</label>
            <input
                type="text"
                id="customer-phone"
                class="form-control"
                placeholder="07XXXXXXXX"
            />
        </div>

        <button class="btn btn-success w-100 py-2 fw-semibold" id="checkout-btn">
            <i class="bi bi-whatsapp me-2"></i>Order via WhatsApp
        </button>
        <button class="btn btn-warning w-100 mt-2" id="clear-cart">
            <i class="bi bi-trash me-2"></i>Clear Cart
        </button>
        <button class="btn btn-secondary w-100 mt-2" id="close-cart">
            <i class="bi bi-x-lg me-2"></i>Close
        </button>
    </div>

    <!-- Product Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content bg-dark border-0">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-white">Product Images</h5>
                    <button
                        type="button"
                        class="btn-close btn-close-white"
                        data-bs-dismiss="modal"
                    ></button>
                </div>
                <div class="modal-body p-0">
                    <div
                        id="imageCarousel"
                        class="carousel slide"
                        data-bs-ride="carousel"
                    >
                        <div class="carousel-inner" id="carouselInner"></div>
                        <button
                            class="carousel-control-prev"
                            type="button"
                            data-bs-target="#imageCarousel"
                            data-bs-slide="prev"
                        >
                            <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button
                            class="carousel-control-next"
                            type="button"
                            data-bs-target="#imageCarousel"
                            data-bs-slide="next"
                        >
                            <span class="carousel-control-next-icon"></span>
                        </button>
                    </div>
                    <div
                        class="d-flex justify-content-center gap-2 mt-2 flex-wrap"
                        id="carouselThumbs"
                    ></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        const cart = [];
        let allProducts = [];
        let filteredProducts = [];
        let currentFilters = {
            search: '',
            category: 'all',
            maxPrice: 1000000,
            condition: 'all',
            brand: 'all',
            sort: 'featured'
        };
        let currentPage = 1;
        const productsPerPage = 12;

        // Cart management
        function updateCartUI() {
            const itemsContainer = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countEl = document.getElementById('cart-count');
            const badgeEl = document.getElementById('cart-badge');

            if (!cart.length) {
                itemsContainer.innerHTML = '<p class="text-muted text-center py-4">Your cart is empty</p>';
                totalEl.textContent = '0';
                countEl.textContent = '0';
                badgeEl.textContent = '0';
                return;
            }

            let total = 0;
            itemsContainer.innerHTML = cart.map((item, idx) => {
                total += item.salePrice;
                return `
                    <div class="cart-item d-flex justify-content-between align-items-center">
                        <div class="flex-grow-1">
                            <div class="fw-semibold">${item.title}</div>
                            <small class="text-muted">Ksh ${item.salePrice.toLocaleString()}</small>
                        </div>
                        <button class="btn btn-sm btn-danger remove-item" data-index="${idx}">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                `;
            }).join('');

            totalEl.textContent = total.toLocaleString();
            countEl.textContent = cart.length;
            badgeEl.textContent = cart.length;

            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', () => {
                    cart.splice(btn.dataset.index, 1);
                    updateCartUI();
                });
            });
        }

        // Image handling functions
        function getProductImages(product) {
            // Handle different image structures in the data
            if (product.images && Array.isArray(product.images) && product.images.length > 0) {
                return product.images.map(img => {
                    if (typeof img === 'string') return img;
                    if (img.url) return img.url;
                    return '/images/placeholder.png';
                });
            } else if (product.image) {
                return [product.image];
            } else {
                return ['/images/placeholder.png'];
            }
        }

        function handleImageError(img) {
            img.src = '/images/placeholder.png';
            img.onerror = null; // Prevent infinite loop
        }

        // Filtering and sorting
        function applyFilters() {
            filteredProducts = allProducts.filter(product => {
                // Search filter
                if (currentFilters.search) {
                    const searchTerm = currentFilters.search.toLowerCase();
                    if (!product.title.toLowerCase().includes(searchTerm) && 
                        !(product.description || '').toLowerCase().includes(searchTerm)) {
                        return false;
                    }
                }

                // Category filter
                if (currentFilters.category !== 'all') {
                    if (!product.category || product.category !== currentFilters.category) {
                        return false;
                    }
                }

                // Price filter
                if (product.salePrice > currentFilters.maxPrice) {
                    return false;
                }

                // Condition filter
                if (currentFilters.condition !== 'all') {
                    if (!product.condition || product.condition !== currentFilters.condition) {
                        return false;
                    }
                }

                // Brand filter
                if (currentFilters.brand !== 'all') {
                    if (!product.brand || product.brand !== currentFilters.brand) {
                        return false;
                    }
                }

                return true;
            });

            // Apply sorting
            applySorting();
            
            // Update UI
            updateProductsDisplay();
            updateResultsCount();
        }

        function applySorting() {
            switch(currentFilters.sort) {
                case 'price-low':
                    filteredProducts.sort((a, b) => a.salePrice - b.salePrice);
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => b.salePrice - a.salePrice);
                    break;
                case 'name':
                    filteredProducts.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'newest':
                    filteredProducts.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
                    break;
                default:
                    // featured - keep original order
                    break;
            }
        }

        function updateResultsCount() {
            const resultsCount = document.getElementById('results-count');
            const productsCount = document.getElementById('products-count');
            const totalProducts = filteredProducts.length;

            productsCount.textContent = totalProducts.toLocaleString();

            if (totalProducts === 0) {
                resultsCount.textContent = 'No products found';
            } else if (totalProducts === 1) {
                resultsCount.textContent = '1 product found';
            } else {
                resultsCount.textContent = `${totalProducts.toLocaleString()} products found`;
            }

            // Show/hide load more button
            const loadMoreContainer = document.getElementById('load-more-container');
            const displayedProducts = Math.min(currentPage * productsPerPage, totalProducts);
            
            if (displayedProducts < totalProducts) {
                loadMoreContainer.style.display = 'block';
            } else {
                loadMoreContainer.style.display = 'none';
            }
        }

        function updateProductsDisplay() {
            const container = document.getElementById('shop-products');
            const startIndex = 0;
            const endIndex = currentPage * productsPerPage;
            const productsToShow = filteredProducts.slice(startIndex, endIndex);

            if (!productsToShow.length) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-search display-1 text-muted"></i>
                        <h4 class="mt-3 text-muted">No products found</h4>
                        <p class="text-muted">Try adjusting your filters or search terms</p>
                        <button class="btn btn-primary mt-2" id="reset-filters-view">Reset Filters</button>
                    </div>
                `;
                document.getElementById('reset-filters-view').addEventListener('click', resetFilters);
                return;
            }

            container.innerHTML = productsToShow.map(p => {
                // Calculate discount percentage
                const discount = p.marketPrice > p.salePrice ? 
                    Math.round(((p.marketPrice - p.salePrice) / p.marketPrice) * 100) : 0;

                // Get all images for this product
                const images = getProductImages(p);
                const mainImage = images[0];

                return `
                    <div class="col-product mb-4">
                        <div class="card h-100 product-card position-relative">
                            ${discount > 0 ? `<span class="discount-badge">-${discount}%</span>` : ''}
                            <div class="image-gallery">
                                <img src="${mainImage}" class="card-img-top" alt="${p.title}" 
                                     onerror="handleImageError(this)">
                                ${images.length > 1 ? `<span class="image-count-badge">+${images.length-1} more</span>` : ''}
                            </div>
                            <div class="card-body d-flex flex-column p-3">
                                <h5 class="card-title">${p.title}</h5>
                                <p class="card-text text-muted small flex-grow-1">${p.description || 'Premium gaming product'}</p>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div>
                                        ${p.marketPrice > p.salePrice ? `<span class="market-price">Ksh ${p.marketPrice.toLocaleString()}</span>` : ''}
                                        <span class="sale-price d-block">Ksh ${p.salePrice.toLocaleString()}</span>
                                    </div>
                                    ${p.condition === 'New' ? '<span class="verified-badge"><i class="bi bi-patch-check-fill"></i> New</span>' : ''}
                                </div>
                                <button class="btn btn-primary mt-auto add-to-cart" 
                                        data-id="${p._id}" 
                                        data-title="${p.title}" 
                                        data-price="${p.salePrice}">
                                    <i class="bi bi-cart-plus"></i> Add to Cart
                                </button>
                                <button class="btn btn-outline-secondary mt-2 view-images-btn" 
                                        data-images='${JSON.stringify(images)}'>
                                    <i class="bi bi-images"></i> View Images (${images.length})
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Reattach event listeners
            document.querySelectorAll('.add-to-cart').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.dataset.id;
                    const title = btn.dataset.title;
                    const salePrice = parseFloat(btn.dataset.price);
                    
                    cart.push({ id, title, salePrice });
                    updateCartUI();
                    
                    // Show success feedback
                    btn.innerHTML = '<i class="bi bi-check-lg"></i> Added!';
                    btn.classList.add('btn-success');
                    setTimeout(() => {
                        btn.innerHTML = '<i class="bi bi-cart-plus"></i> Add to Cart';
                        btn.classList.remove('btn-success');
                    }, 2000);
                });
            });

            document.querySelectorAll('.view-images-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const images = JSON.parse(btn.dataset.images);
                    if (!images.length) return alert("No images available.");
                    showImageModal(images);
                });
            });
        }

        function showImageModal(images) {
            const carouselInner = document.getElementById('carouselInner');
            const carouselThumbs = document.getElementById('carouselThumbs');
            
            carouselInner.innerHTML = images.map((img, idx) => `
                <div class="carousel-item ${idx === 0 ? 'active' : ''}">
                    <img src="${img}" class="d-block w-100" style="max-height:80vh; object-fit:contain;" 
                         onerror="handleImageError(this)">
                </div>
            `).join('');

            carouselThumbs.innerHTML = images.map((img, idx) => `
                <img src="${img}" class="carousel-thumb ${idx === 0 ? 'active' : ''}" 
                     style="width:80px; height:80px; object-fit:cover; cursor:pointer;"
                     data-bs-target="#imageCarousel" data-bs-slide-to="${idx}">
            `).join('');

            // Add click event to thumbnails
            carouselThumbs.querySelectorAll('.carousel-thumb').forEach((thumb, idx) => {
                thumb.addEventListener('click', () => {
                    document.querySelectorAll('.carousel-item').forEach(item => item.classList.remove('active'));
                    document.querySelectorAll('.carousel-thumb').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.carousel-item')[idx].classList.add('active');
                    thumb.classList.add('active');
                });
            });

            imageModal.show();
        }

        function resetFilters() {
            currentFilters = {
                search: '',
                category: 'all',
                maxPrice: 1000000,
                condition: 'all',
                brand: 'all',
                sort: 'featured'
            };
            
            document.getElementById('search-input').value = '';
            document.getElementById('filter-search').value = '';
            document.getElementById('price-range').value = 1000000;
            document.getElementById('price-max-display').textContent = 'Ksh 1,000,000';
            document.getElementById('sort-select').value = 'featured';

            // Reset active filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === 'all' || btn.dataset.condition === 'all' || btn.dataset.brand === 'all') {
                    btn.classList.add('active');
                }
            });

            currentPage = 1;
            applyFilters();
        }

        // Load products from backend
        async function loadProducts() {
            try {
                // For demo purposes, we'll create sample products if the API call fails
                // In production, you would use your actual API endpoint
                let sampleProducts = [
                    {
                        _id: "1",
                        title: "PlayStation 5 Console",
                        marketPrice: 80000,
                        salePrice: 75000,
                        description: "Next-gen gaming console with 4K gaming and ray tracing",
                        category: "Consoles",
                        condition: "New",
                        brand: "Sony",
                        images: ["https://via.placeholder.com/400x300?text=PS5+Front", "https://via.placeholder.com/400x300?text=PS5+Back", "https://via.placeholder.com/400x300?text=PS5+Side"]
                    },
                    {
                        _id: "2",
                        title: "Xbox Series X",
                        marketPrice: 75000,
                        salePrice: 70000,
                        description: "Powerful gaming console with 4K gaming capabilities",
                        category: "Consoles",
                        condition: "New",
                        brand: "Microsoft",
                        images: ["https://via.placeholder.com/400x300?text=Xbox+Front", "https://via.placeholder.com/400x300?text=Xbox+Back"]
                    },
                    {
                        _id: "3",
                        title: "Nintendo Switch OLED",
                        marketPrice: 45000,
                        salePrice: 42000,
                        description: "Hybrid gaming console with vibrant OLED screen",
                        category: "Consoles",
                        condition: "New",
                        brand: "Nintendo",
                        images: ["https://via.placeholder.com/400x300?text=Switch+OLED"]
                    },
                    {
                        _id: "4",
                        title: "Razer BlackWidow Keyboard",
                        marketPrice: 15000,
                        salePrice: 12000,
                        description: "Mechanical gaming keyboard with RGB lighting",
                        category: "Keyboards",
                        condition: "New",
                        brand: "Razer",
                        images: ["https://via.placeholder.com/400x300?text=Razer+Keyboard"]
                    },
                    {
                        _id: "5",
                        title: "Logitech G502 Mouse",
                        marketPrice: 8000,
                        salePrice: 6500,
                        description: "High-precision gaming mouse with customizable weights",
                        category: "Mice",
                        condition: "New",
                        brand: "Logitech",
                        images: ["https://via.placeholder.com/400x300?text=G502+Mouse"]
                    },
                    {
                        _id: "6",
                        title: "SteelSeries Arctis 7 Headset",
                        marketPrice: 12000,
                        salePrice: 10000,
                        description: "Wireless gaming headset with premium audio quality",
                        category: "Headsets",
                        condition: "New",
                        brand: "SteelSeries",
                        images: ["https://via.placeholder.com/400x300?text=Arctis+Headset"]
                    },
                    {
                        _id: "7",
                        title: "Samsung Odyssey G7 Monitor",
                        marketPrice: 60000,
                        salePrice: 55000,
                        description: "32-inch curved gaming monitor with 240Hz refresh rate",
                        category: "Monitors",
                        condition: "New",
                        brand: "Samsung",
                        images: ["https://via.placeholder.com/400x300?text=G7+Monitor"]
                    },
                    {
                        _id: "8",
                        title: "Corsair Vengeance RAM 16GB",
                        marketPrice: 8000,
                        salePrice: 7000,
                        description: "High-performance DDR4 memory for gaming PCs",
                        category: "PC Parts",
                        condition: "New",
                        brand: "Corsair",
                        images: ["https://via.placeholder.com/400x300?text=Corsair+RAM"]
                    }
                ];

                // Try to fetch from your API first, fall back to sample data
                try {
                    const res = await fetch('/products/json');
                    if (res.ok) {
                        allProducts = await res.json();
                    } else {
                        throw new Error('API not available');
                    }
                } catch (err) {
                    console.log('Using sample data:', err);
                    allProducts = sampleProducts;
                }
                
                // Ensure prices are numbers
                allProducts = allProducts.map(p => ({
                    ...p,
                    marketPrice: parseFloat(p.marketPrice) || 0,
                    salePrice: parseFloat(p.salePrice) || 0
                }));

                filteredProducts = [...allProducts];
                applyFilters();
            } catch (err) {
                console.error('Error loading products:', err);
                document.getElementById('shop-products').innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-exclamation-triangle display-1 text-danger"></i>
                        <h4 class="mt-3 text-danger">Failed to load products</h4>
                        <p class="text-muted">Please check your connection and try again</p>
                        <button class="btn btn-primary mt-2" onclick="loadProducts()">Retry</button>
                    </div>
                `;
            }
        }

        // Event Listeners
        document.getElementById('cart-toggle').addEventListener('click', () => {
            const sidebar = document.getElementById('cart-sidebar');
            sidebar.style.display = sidebar.style.display === 'block' ? 'none' : 'block';
        });

        document.getElementById('navbar-cart-btn').addEventListener('click', () => {
            const sidebar = document.getElementById('cart-sidebar');
            sidebar.style.display = sidebar.style.display === 'block' ? 'none' : 'block';
        });

        document.getElementById('close-cart').addEventListener('click', () => {
            document.getElementById('cart-sidebar').style.display = 'none';
        });

        document.getElementById('checkout-btn').addEventListener('click', () => {
            if (!cart.length) return alert("Your cart is empty!");
            
            const name = document.getElementById("customer-name").value.trim();
            const phone = document.getElementById("customer-phone").value.trim();
            
            if (!name || !phone) return alert("Please enter your name and phone number.");

            let orderDetails = cart.map((item, idx) => 
                `${idx + 1}. ${item.title} - Ksh ${item.salePrice.toLocaleString()}`
            ).join("%0A");
            
            let total = cart.reduce((sum, item) => sum + item.salePrice, 0);
            
            let message = `Hello Maximum Gamers!%0A%0AMy name is ${name}, phone: ${phone}.%0A%0AI want to order:%0A%0A${orderDetails}%0A%0ATotal: Ksh ${total.toLocaleString()}%0A%0APlease confirm my order.`;
            
            window.open(`https://wa.me/254718804786?text=${message}`, "_blank");
            
            // Clear cart after order
            cart.length = 0;
            updateCartUI();
            document.getElementById('cart-sidebar').style.display = 'none';
        });

        document.getElementById('clear-cart').addEventListener('click', () => {
            if (!cart.length) return alert("Your cart is empty.");
            if (confirm("Are you sure you want to clear your cart?")) {
                cart.length = 0;
                updateCartUI();
            }
        });

        // Filter event listeners
        document.getElementById('search-input').addEventListener('input', (e) => {
            currentFilters.search = e.target.value;
            currentPage = 1;
            applyFilters();
        });

        document.getElementById('filter-search').addEventListener('input', (e) => {
            currentFilters.search = e.target.value;
            currentPage = 1;
            applyFilters();
        });

        document.getElementById('price-range').addEventListener('input', (e) => {
            currentFilters.maxPrice = parseInt(e.target.value);
            document.getElementById('price-max-display').textContent = `Ksh ${currentFilters.maxPrice.toLocaleString()}`;
            currentPage = 1;
            applyFilters();
        });

        document.getElementById('sort-select').addEventListener('change', (e) => {
            currentFilters.sort = e.target.value;
            applyFilters();
        });

        // Filter button event listeners
        document.querySelectorAll('.category-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilters.category = btn.dataset.category;
                currentPage = 1;
                applyFilters();
            });
        });

        document.querySelectorAll('.condition-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.condition-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilters.condition = btn.dataset.condition;
                currentPage = 1;
                applyFilters();
            });
        });

        document.querySelectorAll('.brand-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.brand-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilters.brand = btn.dataset.brand;
                currentPage = 1;
                applyFilters();
            });
        });

        document.getElementById('clear-filters').addEventListener('click', resetFilters);

        document.getElementById('load-more-btn').addEventListener('click', () => {
            currentPage++;
            updateProductsDisplay();
            updateResultsCount();
        });

        // Initialize modal
        const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));

        // Initialize
        window.addEventListener('DOMContentLoaded', loadProducts);
    </script>
</body>
</html>